{
  "Comment": "Credit card ML monitoring only pipeline",
  "StartAt": "RunMonitoringJob",
  "States": {
    "RunMonitoringJob": {
      "Type": "Task",
      "Resource": "arn:aws:states:::sagemaker:createProcessingJob.sync",
      "Parameters": {
        "ProcessingJobName.$": "States.Format('creditcard-monitoring-{}', States.UUID())",
        "RoleArn": "arn:aws:iam::075960506214:role/service-role/AmazonSageMaker-ExecutionRole-20251229T181530",
        "AppSpecification": {
          "ImageUri": "683313688378.dkr.ecr.us-east-1.amazonaws.com/sagemaker-scikit-learn:1.2-1-cpu-py3",
          "ContainerEntrypoint": [
            "bash",
            "-c",
            "tar -xzf /opt/ml/processing/code/source_dir.tar.gz -C /opt/ml/processing/code && pip install -r /opt/ml/processing/code/requirements.txt && python /opt/ml/processing/code/monitor.py"
          ]
        },
        "ProcessingInputs": [
          {
            "InputName": "reference",
            "S3Input": {
              "S3Uri": "s3://mlops-creditcard/monitoring_inputs/Training_Data/",
              "LocalPath": "/opt/ml/processing/input/reference",
              "S3DataType": "S3Prefix",
              "S3InputMode": "File"
            }
          },
          {
            "InputName": "current",
            "S3Input": {
              "S3Uri": "s3://mlops-creditcard/monitoring_inputs/Current_Data/",
              "LocalPath": "/opt/ml/processing/input/current",
              "S3DataType": "S3Prefix",
              "S3InputMode": "File"
            }
          },
          {
            "InputName": "model",
            "S3Input": {
              "S3Uri": "s3://mlops-creditcard/prod_outputs/champion_model/",
              "LocalPath": "/opt/ml/processing/input/model",
              "S3DataType": "S3Prefix",
              "S3InputMode": "File"
            }
          },
          {
            "InputName": "code",
            "S3Input": {
              "S3Uri": "s3://mlops-creditcard/prod_codes/source_dir.tar.gz",
              "LocalPath": "/opt/ml/processing/code",
              "S3DataType": "S3Prefix",
              "S3InputMode": "File"
            }
          }
        ],
        "ProcessingOutputConfig": {
          "Outputs": [
            {
              "OutputName": "drift",
              "S3Output": {
                "S3Uri": "s3://mlops-creditcard/monitoring_outputs/drift/",
                "LocalPath": "/opt/ml/processing/output/drift",
                "S3UploadMode": "EndOfJob"
              }
            },
            {
              "OutputName": "metrics",
              "S3Output": {
                "S3Uri": "s3://mlops-creditcard/monitoring_outputs/metrics/",
                "LocalPath": "/opt/ml/processing/output/metrics",
                "S3UploadMode": "EndOfJob"
              }
            },
            {
              "OutputName": "retraining",
              "S3Output": {
                "S3Uri": "s3://mlops-creditcard/monitoring_outputs/retraining_decision/",
                "LocalPath": "/opt/ml/processing/output/retraining_decision",
                "S3UploadMode": "EndOfJob"
              }
            }
          ]
        },
        "ProcessingResources": {
          "ClusterConfig": {
            "InstanceType": "ml.m5.large",
            "InstanceCount": 1,
            "VolumeSizeInGB": 10
          }
        }
      },
      "End": true
    }
  }
}
